minimum_version: 2.6.1
service: web-agent
primary_role: web
image: supatest/web-agent

registry:
  server: 653584809203.dkr.ecr.ap-southeast-1.amazonaws.com
  username: AWS
  password: <%= %x(aws ecr get-login-password --region ap-southeast-1) %>

builder:
  arch: amd64
  dockerfile: Dockerfile

proxy:
  app_port: 8765
  healthcheck:
    path: /health
    interval: 10
    timeout: 30

# Inject ENV variables into containers (secrets come from .kamal/secrets).
env:
  secret:
    - AZURE_OPENAI_API_KEY
    - AZURE_OPENAI_ENDPOINT
    - AZURE_OPENAI_KEY
    - LMNR_PROJECT_API_KEY
    - AUTOMATION_BASE_URL
    - BROWSER_USE_LOGGING_LEVEL
    - ANONYMIZED_TELEMETRY
    - LMNR_PROJECT_API_KEY
  clear:
    PORT: 8765
